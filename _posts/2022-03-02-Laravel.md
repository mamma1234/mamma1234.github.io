---
layout: post
title: "Laravel"
description: 
headline: 
modified: 2022-03-02
category: webdevelopment
imagefeature: cover3.jpg
tags: [Laravel]
mathjax: 
chart: 
share: true
comments: true
featured: true
disqus:
---

# Record

## 목차
- [](#)
- [개념](#개념)
- [특징](#특징)
- [설치](#설치)
- [시작](#시작)
- [주요 디렉토리 및 기능](#주요-디렉토리-및-기능)
    - [routes](#routes)
    - [app](#app)
    - [database](#database)
    - [resources](#resources)
    - [.env](#.env)
    - [eloquent ORM](#eloquent-orm)
    - [One To One](#One-To-One)
    - [One To Many](#One-To-Many)
    - [One To Many (Inverse)](#One-To-Many-(Inverse))
    - [Many To Many](#Many-To-Many)
    - [Eager 로딩](#eager-로딩)
    - [csrf](#csrf)
    - [eloquent orm query log](#eloquent-orm-query-log)
    - [view 값 전달](#view-값-전달)
    - [json response](#json-response)
    - [collection](#collection)
    - [middleware](#middleware)
    - [pagination](#pagination)
- [artisan](#artisan)
- [Assets](#Assets)
- [PEAR, PECL](#PEAR,-PECL)
- [Blade](#Blade)
    - [@if, @unless, @isset, @empty, @auth, @guest, @hasSection](#조건문)
    - [@switch](#스위치)
    - [@for, @foreach, @forelse, @while](#반복문)
    - [주석](#주석)
    - [PHP](#PHP)
- [기타](#기타)
    - [라라벨 프로젝트 버전 확인](#라라벨-프로젝트-버전-확인)
    - [Honeypot](#honeypot)
    - [route 수정 후 적용 안될 때](#route-수정-후-적용-안될-때)
    - [.env 등 config 파일 수정 시](#.env-등-config-파일-수정-시)
    - [Log](#log)
    - [Sql Log][#sql-log]
- [laravel-debugbar](#laravel-debugbar)
- [vue 연동](#vue-연동)
    - [브로드캐스팅](#브로드캐스팅)
- [Facade](#Facade)
- [함수 설명](#함수-설명)

## 개념
- 

## 특징
- 모델-뷰-컨트롤러(MODEL-VIEW-CONTROLLER) 아키텍쳐 패턴 지원
- 객체지향(OBJECT-ORIENTED) 라이브러리
- 명령 줄 인터페이스(COMMAND-LINE INTERFACE)
- 라라벨의 템플릿 엔진
- 효율적인 ORM과 데이터베이스 관리
- 효과적인 단위 테스트를 위한 적절한 지원.
- 라라벨은 100% 오픈소스이다.


## 설치
- npm
- yarn
- /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
- brew update
- composer
```JavaScript
    php -r "copy('https://getcomposer.org/installer', 'composer-setup.php');"
    php -r "if (hash_file('sha384', 'composer-setup.php') === '906a84df04cea2aa72f40b5f787e49f22d4c2f19492ac310e8cba5b96ac8b64115ac402c8cd292b8a03482574915d1a8') { echo 'Installer verified'; } else { echo 'Installer corrupt'; unlink('composer-setup.php'); } echo PHP_EOL;"
    php composer-setup.php
    php -r "unlink('composer-setup.php');"
```
- sudo mv composer.phar /usr/local/bin/composer
- composer global require laravel/installer

## 시작
- 라라벨 설치
    - laravel new blog
    - composer create-project --prefer-dist laravel/laravel blog2

-  PHP에 내장된 개발 서버를 사용하여 애플리케이션을 구동
    - php artisan serve



## 주요 디렉토리 및 기능
- routes
    - web.php : web.php 파일은 RouteServiceProvider 의 web 미들웨어 그룹안에 포함되는 라우트들을 포함하고 있으며, 세션 상태, CSRF 보호, 쿠키 암호화 기능을 제공합니다. 만약 여러분의 애플리케이션이 상태를 저장하지 않는 RESTful API를 제공하지 않는다면, 대부분의 라우트는 web.php 파일안에 정의될것입니다.
```JavaScript
        // view return
        Route::get('/', function () {
            return view('welcome');
        });
        ==> 
        resources/views/welcome.blade.php
        // controller return
        Route::get('/home', 'HomeController@index')->name('home');
        ==>
        app/Http/Controllers/HomeController.php
            function index()
```

- app : app 디렉토리에는 애플리케이션의 핵심 코드가 들어 있습니다. 우리는 이 디렉토리를 더 자세히 살펴볼 것입니다. 애플리케이션의 거의 모든 클래스가 이 디렉토리에 있습니다.
    - Http : Http 디렉토리는 컨트롤러, 미들웨어 그리고 form request 를 가지고 있습니다. 애플리케이션으로 들어오는 request를 처리하는 대부분의 로직은 이 디렉토리에 위치하고 있습니다.
        - Contollers : 컨트롤러는 클래스를 구성하여 HTTP 요청에 대한 그룹을 지정합니다
```JavaScript
            php artisan make:controller BlogController
            //Laravel 리소스 라우팅은 일반적인 "CRUD" 경로를 한 줄의 코드로 컨트롤러에 할당합니다.
            php artisan make:controller CategoryController --resource
            //route 정보 확인
            php artisan route:list
```
        - Middleware : 미들웨어는 애플리케이션으로 들어온 HTTP 요청을 간편하게 필터링할 수 있는 방법을 제공합니다

<br>

- database : database 디렉토리는 데이터베이스 마이그레이션 파일, 모델 팩토리, 시딩 파일들을 포함하고 있습니다. 원한다면, 이 디렉토리를 SQLite 데이터베이스가 저장되는 곳으로 사용할수도 있습니다.



- resources : 디렉토리는 뷰 파일과 LESS, SASS, 자바스크립트와 같이 컴파일 되기 전의 asset파일들을 가지고 있습니다. 
    이 디렉토리는 또한 다국어 파일도 들어 있습니다.
    - views
```JavaScript 
        <a href="{{ Route('home.show') }}">go to home show</a>
        <==
        Route::get('/home/show', 'HomeController@show')->name('home.show');
```
        - layouts
```JavaScript    
            //layouts 적용
            @extends('layouts.app')
            ==>
            resources/views/layouts/app.blade.php
```
```JavaScript 
            //layouts 의 위치 적용
            @section('content')
            ==>
            @yield('content')
```


- .env


### eloquent ORM
- Model
```JavaScript  
    php artisan make:model Blog -mc
    //m - migration 생성
    //c - controller 생성
    // 생성 파일
    app/Http/Controllers/BlogController.php
    app/Blog.php
    database/migrations/2022_03_10_053827_create_blogs_table.php
    // migration
    php artisan migrate
```
    - model
```JavaScript  
        class Blog extends Model
        {
            //대량 할당(Mass Assignment)할 모델의 속성을 정의해야 하며 이는 모델에 $fillable 속성을 사용해서 할 수 있습니다. 
            // protected $fillable = [
            //     'user_id','title', 'description'
            // ];
            //모든 속성들이 대량 할당이 가능하게 하고자 한다면, $guarded 프로퍼티를 빈 배열로 정의하면 됩니다.
            protected $guarded = []; 
        }
```
    - controller
```JavaScript  
    public function store(Request $request)
    {
        // return $request->all();
        // dd($request->all());
        //
        // case 1
        // $blog = new Blog();
        // $blog->user_id = $request->user()->id;
        // $blog->title = $request->title;
        // $blog->description = $request->description;
        // $blog->save();
        //
        // case 2
        Blog::create([
            'user_id' => $request->user()->id,
            'title' => $request->title,
            'description' => $request->description,
        ]);
        return redirect()->back();
    }
```

- One To One
```JavaScript
    //CASE 1
    //User.php
    public function userDetail()
    {
        return $this->hasOne('App\UserDetail');
    }
    //
    public function show($id)
    {
        $user = User::find($id)->userDetail;
        dd($user);
    }
    //CASE 2
    //UserDetail.php
    public function user(): BelongsTo
    {
        return $this->belongsTo(User::class, 'foreign_key', 'other_key');
    }
    //
    public function user()
    {
        return $this->belongsTo('App\User');
    }
    //public function show($id)
    //{
    //    $user_detail = UserDetail::find($id);
    //    dd($user_detail);
    //}
```

- One To Many

```JavaScript
    //BlogController.php
    public function show($id)
    {
        // $blog = Blog::where('id', $id)->firstOrFail();
        $blog = Blog::with(['comments'])->where('id', $id)->firstOrFail();
        //compact 메서드를 이용해 blade 에 데이터를 전달.
        return view('blogs.show', compact('blog'));
    }
    //show.blade.php
    <div>
        @foreach($blog->comments as $comment)
            <p>{{ $comment->body }}</p>
        @endforeach
    </div>
    <form action="{{ route('comments.store') }}" method="POST">
        @csrf
        <input type="hidden" name="blog_id"  value={{$blog->id}}><br>
        <input type="text" name="body" placeholder="write..."><br>
        <button>save</button>
    </form>
    //CommentController.php
    public function store(Request $request)
    {
        Comment::create([
            'user_id' => $request->user()->id,
            'blog_id' => $request->blog_id,
            'body' => $request->body,
        ]);
        return redirect()->back();
    }
    //Blog.php
    public function Comments()
    {
        return $this->hasMany('App\Comment');
    }
```

- One To Many (Inverse)

- Many To Many

```JavaScript
    //migrate php file
    //Foreign Key Constraints
    $table->foreign('post_id')->references('id')->on('posts')->onDelete('cascade');
    $table->foreign('tag_id')->references('id')->on('tags')->onDelete('cascade');
    //web.php
    Route::get('/postcreate', 'PostController@create')->name('posts.create');
    Route::post('/posts', 'PostController@store')->name('posts.store');
    //PostController.php
    public function create()
    {
        $posts = Post::with(['tags'])->get();
        return view('posts.create', compact('posts'));
    }
    public function store(Request $request)
    {
        // dd($request->only(['title']));
        // dd($request->all());
        // $temp = $request->user()->posts();
        // dd($temp);
        $post = $request->user()->posts()->create($request->only(['title']));
        // dd($post);
        $tags = explode(',', $request->tags);
        $tags = array_map('trim', $tags);
        $tags = array_filter($tags, 'strlen');
        foreach($tags as $tag) {
            $tag = Tag::updateOrCreate([
                'name' => $tag
            ]);
            $post->tags()->attach($tag->id);
        }
        return redirect()->back();
    }
    //create.blade.php
                @foreach($posts  as $post)
                <div class="mb-3">
                    <div>
                        Title: {{ $post->title }} <br>
                        Tags: @foreach($post->tags as $tag) {{ $tag->name }} @endforeach
                    </div>
                </div>
                @endforeach
                <div class="mb-5">
                    <form action="{{ route('posts.store') }}" method="POST">
                        @csrf
                        Title: <input type="text" name="title" >
                        <br>
                        <br>
                        Tags: <input type="text" name="tags"><br>
                        <br>
                        <br>
                        <button>submit</button>
                    </form>
                </div>
    //Post.php
    public function tags()
    {
        return $this->belongsToMany('App\Tag');
    }
```



### Eager 로딩
- Eager Loading
- [https://laravel.kr/docs/7.x/eloquent-relationships#Eager%20%EB%A1%9C%EB%94%A9](https://laravel.kr/docs/7.x/eloquent-relationships#Eager%20%EB%A1%9C%EB%94%A9)

- N+1 쿼리
```JavaScript
    //Comment.php
    public function blog()
    {
        return $this->belongsTo('App\Blog');
    }
    //CommentController.php
    public function index()
    {
        // $comments = Comment::all();
        $comments = Comment::with('blog')->get();
        return view('comments.index', compact('comments'));
    }
    //index.blade.php
            @foreach ($comments as $comment)
                <p>Comment: {{ $comment->body }}</p>
                <p>Blog Title: {{ $comment->blog->title }}</p>
            @endforeach
```



### csrf
- CSRF 공격(Cross Site Request Forgery)은 웹 어플리케이션 취약점 중 하나로 인터넷 사용자(희생자)가 자신의 의지와는 무관하게 공격자가 의도한 행위(수정, 삭제, 등록 등)를 특정 웹사이트에 요청하게 만드는 공격입니다.
    - form
```JavaScript  
        <form method="POST" action="/profile">
            @csrf
            ...
        </form>
```
    - javascript
```JavaScript  
        resources/js/bootstrap.js
        //token
        let token:any = document.head.querySelector('meta[name="csrf-token"]');
        if (token) {
            (<any>window).axios.defaults.headers.common['X-CSRF-TOKEN'] = token.content;
        } else {
            console.error('CSRF token not found: https://laravel.com/docs/csrf#csrf-x-csrf-token');
        }
```



### eloquent orm query log 
```JavaScript 
config/logging.php
//
'channels' => [
  'sql' => [
    'driver' => 'daily',
    'path' => storage_path('logs/sql.log'),
    'level' => 'debug',
    'days' => 14,
  ],
//
app/Provides/AppServiceProvider.php
//
public function register()
{
    if ($this->app->environment() !== 'production') {
    	\Event::listen('Illuminate\Database\Events\QueryExecuted', function ($query) {
        	\Log::channel('sql')->info([
            'sql' => $query->sql,
            'bindings' => $query->bindings,
            'time' => $query->time,
	        ]);
    	});
	}
}
```

### view 값 전달
- compact
```JavaScript 
    return view('products.index', compact('title', 'description'));
```
- with
```JavaScript 
    return view('products.index') ->with(['title'=>$title,'description'=>$description]);
```
- direct
```JavaScript 
    return view('products.index', ['data' => $data]);
```

### json response
```JavaScript 
    return response()->json(['name'=>'Name', 'state'=>'CA'], 200);
```

### collection
```JavaScript 
    Route::get('/collect', function () {
        $collection = collect(['taylor', 'abigail', null])->map(function ($name) {
            return strtoupper($name);
        })->reject(function ($name) {
            return empty($name);
        });
        dd($collection);
    });
```

### middleware
- [https://laravel.kr/docs/7.x/middleware](https://laravel.kr/docs/7.x/middleware)

```JavaScript 
    php artisan make:middleware CheckAge
    //
    //app/Http/Middleware/CheckAge.php
    //before
    public function handle($request, Closure $next)
    {
        if ($request->age <= 20) {
            return redirect('too-young');
        }
        return $next($request);
    }
    //after
    public function handle($request, Closure $next)
    {
        $response = $next($request);
        if ($request->age <= 20) {
            return redirect('too-young');
        }
        return $response;
    }
    //
    //app/Http/Kernel.php
    protected $routeMiddleware = [
        'checkage' => \App\Http\Middleware\CheckAge::class,
    ];
    //
    //web.php
    Route::get('/enter', function () {
        dd('testing');
    })->middleware('checkage');
```

### pagination
```JavaScript
    //index.blade.php
            @foreach ($users as $user)
                <p>name: {{ $user->name }}</p>
            @endforeach
            {{ $users->links() }}
    //web.php
    Route::get('/pagination', 'PaginationController@index')->name('pagination');
    //PaginationController.php
    public function index()
    {
        $users = User::paginate(10);
        return view('pagination.index', compact('users'));
    }
```

## artisan
- artisan 명령어
- artisan 은 라라벨에 내장된 명령행 방식의 통합 유틸리티로 루비온레일의 rails 콘솔처럼 라라벨로 프로젝트를 진행하기 위해서는 꼭 알아야 할 필수 요소로 다음과 같은 작업을 할 수 있습니다.

    - 라라벨 애플리케이션의 구성(라우팅,  캐시, 환경값)을 검사하고 설정 변경
    - 애플리케이션을 정비/운영 모드로 전환 
    - 라라벨 개발에 필요한 여러 가지 타입(컨트롤러, 리스너, 모델, 미들웨어등) 생성
    - 라라벨 성능에 영향을 주는 여러 가지 설정 변경
    - 대화형으로 라라벨 애플리케이션 프로토타이핑 및 디버깅

### artisan migrate
- 테이블 변경사항 공유
```JavaScript
    php artisan migrate
```

    - up 메소드는 데이터베이스에 테이블, 컬럼, 인덱스를 추가하는데 사용되고
    - down 메소드는 up 메소드의 동작을 취소합니다.
    
- 마이그레이션 파일 생성
```JavaScript
    php artisan make:migration create_users_table
```

- 마이그레이션 되돌리기
```JavaScript
    php artisan migrate:rollback
    php artisan migrate:rollback --step=5   //최근 5개의 마이그레이션만 되돌립니다:
    php artisan migrate:reset  //모든 마이그레이션 되돌리기
```

- 마이그레이션 명령어
    - [https://laravel.kr/docs/5.7/migrations](https://laravel.kr/docs/5.7/migrations)

    - 테이블 생성하기
    ```JavaScript
    Schema::create('users', function (Blueprint $table) {
        $table->increments('id');
    });
    ```

    - 테이블 / 컬럼이 존재하는지 확인하기
    ```JavaScript
    if (Schema::hasTable('users')) {
        //
    }

    if (Schema::hasColumn('users', 'email')) {
        //
    }
    ```

    - 데이터베이스 커넥션-connection & 테이블 옵션
    ```JavaScript
    Schema::connection('foo')->create('users', function (Blueprint $table) {
        $table->increments('id');
    });
    ```

    - 테이블 이름 변경 / 제거하기
    ```JavaScript
    Schema::rename($from, $to);

    Schema::drop('users');

    Schema::dropIfExists('users');
    ```

    - 컬럼 생성하기
    ```JavaScript
    Schema::table('users', function (Blueprint $table) {
        $table->string('email');
    });
    ```

    - 컬럼 Modifiers
    ```JavaScript
    Schema::table('users', function (Blueprint $table) {
        $table->string('email')->nullable();
    });
    ```

    * 사전 준비사항
    - 컬럼을 수정하기 전에, 꼭 composer.json 파일에 doctrine/dbal 의존성을 추가하십시오. Doctrine DBAL 라이브러리는 컬럼의 현재 상태를 확인하고 필요한 SQL 쿼리를 생성하여 컬럼에 지정된 변경사항을 수행하기 위해 사용됩니다:
    ```JavaScript
    composer require doctrine/dbal
    ```

    - 컬럼의 속성 변경하기
    ```JavaScript
    Schema::table('users', function (Blueprint $table) {
        $table->string('name', 50)->change();
    });
    컬럼을 nullable로 수정할 수도 있습니다:

    Schema::table('users', function (Blueprint $table) {
        $table->string('name', 50)->nullable()->change();
    });
    ```

    - 컬럼의 이름 변경하기
    ```JavaScript
    Schema::table('users', function (Blueprint $table) {
        $table->renameColumn('from', 'to');
    });
    ```

    - 컬럼 삭제하기
    ```JavaScript
    Schema::table('users', function (Blueprint $table) {
        $table->dropColumn('votes');
    });
    dropColumn 메소드에 컬럼 이름들의 배열을 전달하면 테이블에서 여러 개의 컬럼을 없앨 수 있습니다:

    Schema::table('users', function (Blueprint $table) {
        $table->dropColumn(['votes', 'avatar', 'location']);
    });
    ```

    - 인덱스 생성하기
    ```JavaScript
    $table->string('email')->unique();
    위와 같이 하는 대신에, 컬럼을 정의한 뒤에 인덱스를 생성할 수도 있습니다. 예를 들어:

    $table->unique('email');
    인덱스 메소드에 컬럼의 배열을 전달하여 복합 인덱스를 생성할 수도 있습니다:

    $table->index(['account_id', 'created_at']);
    라라벨은 자동으로 알맞은 인덱스 이름을 생성할 것입니다만, 메소드의 두번째 인자로 인덱스 이름을 지정할 수도 있습니다:

    $table->unique('email', 'unique_email');
    ```

    - 인덱스 이름 변경하기
    ```JavaScript
    $table->renameIndex('from', 'to')
    ```

    - 인덱스 삭제하기
    ```JavaScript
    Schema::table('geo', function (Blueprint $table) {
        $table->dropIndex(['state']); // Drops index 'geo_state_index'
    });
    ```

    - 외래키 제한
    ```JavaScript
    라라벨은 데이터베이스에서 또한 참조 무결성을 강제하는 외래 키 제한을 생성하는 것을 제공합니다. 예를 들어 users 테이블의 id 컬럼을 참조하는 posts 테이블에 user_id 컬럼을 정의해보겠습니다:

    Schema::table('posts', function (Blueprint $table) {
        $table->unsignedInteger('user_id');

        $table->foreign('user_id')->references('id')->on('users');
    });
    제한(constraint)의 "on delete"와 "on update" 속성에 원하는 동작을 지정할 수도 있습니다:

    $table->foreign('user_id')
        ->references('id')->on('users')
        ->onDelete('cascade');
    외래 키를 지우기 위해서는 dropForeign 메소드를 사용할 수 있습니다. 외래 키 제한은 인덱스와 같은 명명 규칙을 사용합니다. 따라서 테이블 이름과 제한(constraint)의 컬럼들을 합치고 뒤에 "_foreign"을 붙일 것입니다:

    $table->dropForeign('posts_user_id_foreign');
    또는 배열 값을 전달하면 삭제시 자동으로 컨벤션 규칙에 따르는 이름이 사용됩니다:

    $table->dropForeign(['user_id']);
    마이그레이션에서 다음의 메소드들을 사용하여 외래키 제약을 활성/비활성 할 수 있습니다:

    Schema::enableForeignKeyConstraints();

    Schema::disableForeignKeyConstraints();
    ```


### artisan db:seed
- 라라벨에서는 시드(seed) 클래스를 사용해서 테스트 데이터를 데이터베이스에 설정하는 간단한 메소드를 포함하고 있습니다. 



## Assets 변경 감시하기
- npm run watch 명령어는 터미널에서 계속 실행되면서 모든 관련된 파일의 변경사항을 감시합니다. Webpack은 변경사항이 감지되면 자동으로 이를 다시 컴파일 합니다:
```JavaScript
    npm run watch
```

- 구동환경에 따라서 파일의 변경사항을 발생해도 Webpack이 업데이트 되지 않게 할 수도 있습니다. 사용하는 시스템이 이 경우라면, watch-poll 명령어 사용을 고려하십시오:
```JavaScript
    npm run watch-poll
```

## PEAR, PECL
PHP Extension and Application Repository; PEAR
```JavaScript
PHP 익스텐션 및 애플리케이션 저장소; 피어
/usr/bin/pear
PHP Extension Community Library; PECL
PHP 확장모듈 커뮤니티 라이브러리; 피클
/usr/bin/pecl
```

- PEAR
    - PHP 확장모듈 프레임워크 및 배포 시스템
    - 되도록이면 이것 대신 composer 사용을 권장함[1]

```JavaScript
[root@zetawiki ~]# cat /usr/bin/pear
#!/bin/sh
exec /usr/bin/php -C -d include_path=/usr/share/pear \
    -d output_buffering=1 /usr/share/pear/pearcmd.php "$@"
```

- PECL
    - PHP 확장모듈 저장소
    - 자매 저장소 PEAR와 공유됨
Peclsmall.gif
2.1 기본값
pecl은 알고 보면 리눅스쉘에서 peclcmd.php를 돌리는 스크립트이다.

```JavaScript
[root@zetawiki ~]# cat /usr/bin/pecl
#!/bin/sh
exec /usr/bin/php -C -n -q -d include_path=/usr/share/pear \
    -d output_buffering=1 /usr/share/pear/peclcmd.php "$@"
```

- 설치, 확인
```JavaScript
pear version
pecl version
apt-get install php-pear
```

## Blade
### 조건문
    - @if, @elseif, @else, @endif

```JavaScript
    @if (count($records) === 1)
        I have one record!
    @elseif (count($records) > 1)
        I have multiple records!
    @else
        I don't have any records!
    @endif
```

    - @unless, @isset, @empty 

```JavaScript
    @unless (Auth::check())
        You are not signed in.
    @endunless

    @isset($records)
        // $records is defined and is not null...
    @endisset

    @empty($records)
        // $records is "empty"...
    @endempty
```

    - @auth, @guest

```JavaScript
    인증 관련 지시어
    @auth 그리고 @guest 지시어는 현재 접속자가 인증된 사용자인지 아니면 guest 인지 판별하는데 사용가능한 편의 기능입니다.

    @auth
        // The user is authenticated...
    @endauth

    @guest
        // The user is not authenticated...
    @endguest
    필요한 경우, @auth 와 @guest 지시어에 체크하고자 하는 인증 guard를 지정할 수 있습니다.

    @auth('admin')
        // The user is authenticated...
    @endauth

    @guest('admin')
        // The user is not authenticated...
    @endguest
```

    - @hasSection

```JavaScript
    섹션 지시어
    @hasSection 지시어를 사용하여 섹션이 내용을 가지고 있는지 확인할 수 있습니다.

    @hasSection('navigation')
        <div class="pull-right">
            @yield('navigation')
        </div>

        <div class="clearfix"></div>
    @endif
```

### 스위치
    - @switch, @case, @break, @default, @endswitch

```JavaScript
    @switch($i)
        @case(1)
            First case...
            @break

        @case(2)
            Second case...
            @break

        @default
            Default case...
    @endswitch
```

### 반복문
    - @for, @foreach, @forelse, @while

```JavaScript
    @for ($i = 0; $i < 10; $i++)
        The current value is {{ $i }}
    @endfor

    @foreach ($users as $user)
        <p>This is user {{ $user->id }}</p>
    @endforeach

    @forelse ($users as $user)
        <li>{{ $user->name }}</li>
    @empty
        <p>No users</p>
    @endforelse

    @while (true)
        <p>I'm looping forever.</p>
    @endwhile
```

    - @break, @continue

```JavaScript
    @foreach ($users as $user)
        @if ($user->type == 1)
            @continue
        @endif

        <li>{{ $user->name }}</li>

        @if ($user->number == 5)
            @break
        @endif
    @endforeach

    @foreach ($users as $user)
        @continue($user->type == 1)

        <li>{{ $user->name }}</li>

        @break($user->number == 5)
    @endforeach
```

    - $loop

```JavaScript
    @foreach ($users as $user)
        @if ($loop->first)
            This is the first iteration.
        @endif

        @if ($loop->last)
            This is the last iteration.
        @endif

        <p>This is user {{ $user->id }}</p>
    @endforeach

    반복문이 중첩된 경우라면, 상위 반복문의 $loop 변수에 parent 속성을 통해서 액세스 할 수 있습니다.

    @foreach ($users as $user)
        @foreach ($user->posts as $post)
            @if ($loop->parent->first)
                This is first iteration of the parent loop.
            @endif
        @endforeach
    @endforeach
```

### 주석
- 블레이드는 또한 뷰에 주석을 정의할 수 있습니다. 하지만 HTML 주석과는 다르게 블레이드 주석은 애플리케이션이 반환하는 HTML에 포함되어 있지 않습니다.

```JavaScript
{{-- This comment will not be present in the rendered HTML --}}
```

### PHP
- 블레이드는 또한 뷰에 주석을 정의할 수 있습니다. 하지만 HTML 주석과는 다르게 블레이드 주석은 애플리케이션이 반환하는 HTML에 포함되어 있지 않습니다.

```JavaScript
{{-- This comment will not be present in the rendered HTML --}}
```

## 기타

### 라라벨 프로젝트 버전 확인
```JavaScript
root@zetawiki:/var/www/laravel# cat composer.json | grep '"laravel/framework"'
        "laravel/framework": "5.5.*",
```
### Honeypot
- [https://github.com/spatie/laravel-honeypot](https://github.com/spatie/laravel-honeypot)

### route 수정 후 적용 안될 때
php artisan route:cache

### .env 등 config 파일 수정 시
php artisan config:clear
php artisan cache:clear

### Log
- [https://laravel.kr/docs/7.x/logging](https://laravel.kr/docs/7.x/logging)

```JavaScript
use Illuminate\Support\Facades\Log;
Log::debug('An informational message.');
```

### SQL Log
- [https://www.lesstif.com/php-and-laravel/5-eloquent-orm-query-log-31850508.html](https://www.lesstif.com/php-and-laravel/5-eloquent-orm-query-log-31850508.html)

```JavaScript
//app/Providers/AppServiceProvider.php
    public function register()
    {
        //daekyu.park debug..
        if ($this->app->environment() !== 'production') {
            \Event::listen('Illuminate\Database\Events\QueryExecuted', function ($query) {
                \Log::channel('sql')->info([
                    'sql' => $query->sql,
                    'bindings' => $query->bindings,
                    'time' => $query->time,
                ]);
            });
        }
    }
//config/logging.php
        //daekyu.park debug..
        'sql' => [
            'driver' => 'daily',
            'path' => storage_path('logs/sql.log'),
            'level' => 'debug',
            'days' => 14,
        ],
```

## laravel-debugbar 
```JavaScript
composer require barryvdh/laravel-debugbar --dev
APP_DEBUG is true
```


## vue 연동
- [https://github.com/mamma1234/chobo-chat](https://github.com/mamma1234/chobo-chat)

- install

```JavaScript

//laravel old
php artisan preset none
php artisan preset vue 

//laravel 7.x
composer require laravel/ui --dev
php artisan ui vue

    "devDependencies": {
        "vue": "^2.5.17",
        "vue-template-compiler": "^2.6.10"
    }

https://github.com/laravel-frontend-presets/tailwindcss

https://packagist.org/packages/laravel-frontend-presets/tailwindcss#4.2.0

composer require laravel-frontend-presets/tailwindcss:4.2 --dev

php artisan ui tailwindcss --auth

npm install

php artisan serve

npm run dev  // resources -> public 으로 최적화

php artisan migrate

npm run watch // 

//chobo-chat/resources/js/app.js
const app = new Vue({
    el: '#app',
});

//debug bar 
composer require barryvdh/laravel-debugbar --dev

php artisan make:model Message -mc

php artisan migrate
```

- api route
```JavaScript
//chobo-chat/routes/api.php
// domain/api/messages
Route::prefix('messages')->middleware('auth:api')->group(function(){
    Route::post('/', 'MessageController@store');
 });
```

- current-user == currentUser
```JavaScript
//home.blade.php
    <the-chat :current-user="\{\{  auth()->id() \}\}"></the-chat>
//** 
        props: {
            currentUser: {
                type: Number,
                required: true
            }
        },
```

- child 'updatedChatWith' == parent @updatedChatWith
```JavaScript
//ChatUserList.vue 
        methods: {
            updateChatWith(userId) {
                this.$emit('updatedChatWith', userId);
            }
        }
//Chat.vue  
        <ChatUserList
            :current-user="currentUser"
            @updatedChatWith="updateChatWith"
        />
        methods: {
            updateChatWith(value) {
                this.chatWith = value;
            }
        }

```

- v-model == text 양방향처리
```JavaScript
//Chat.vue 
                <input
                    class="border-2 border-solid rounded border-gray-600 w-full p-3"
                    type="text"
                    v-model="text"
                    @keyup.enter="submit"
                >
        data() {
            return {
                chatWith: null,
                text: ''
            }
        },
```

### 브로드캐스팅
- [https://pusher.com/](https://pusher.com/)

- Pusher Channels 설치
```JavaScript
composer require pusher/pusher-php-server "~4.0"
```

- 브로드캐스트 받기 laravel-echo
```JavaScript
 npm install --save laravel-echo pusher-js
```

- bootstrap.js
```JavaScript
 import Echo from 'laravel-echo';

window.Pusher = require('pusher-js');

window.Echo = new Echo({
    broadcaster: 'pusher',
    key: process.env.MIX_PUSHER_APP_KEY,
    cluster: process.env.MIX_PUSHER_APP_CLUSTER,
    forceTLS: true
});
```

- .env 
```JavaScript
PUSHER_APP_ID=
PUSHER_APP_KEY=
PUSHER_APP_SECRET=
PUSHER_APP_CLUSTER=
BROADCAST_DRIVER=pusher
```

- BroadcastServiceProvider
```JavaScript
/config/app.php
App\Providers\BroadcastServiceProvider::class,
```

- 이벤트 설치
```JavaScript
php artisan make:event MessageSent
//implements 추가
class MessageSent implements ShouldBroadcast
```



## 서비스 프로바이더
- 라라벨에 포함되어 있는 config/app.php 파일을 열어 본다면 providers 배열을 볼 수 있을 것입니다. 배열 안에 있는 모든 서비스 프로바이더 클래스가 애플리케이션에 로드됩니다. 대부분의 프로바이더는 "지연된" 프로바이더입니다. 이 말은 모든 요청에 대해서 반드시 로드되지 않고 실제로 필요할 때에 로드 된다는 것을 의미합니다.

- 프로바이더를 생성
```JavaScript
php artisan make:provider RiakServiceProvider
```

- Register 메소드
    - 서비스 컨테이너에 무언가를 바인딩

- Boot 메소드
    - 이 메소드는 모든 다른 서비스 프로바이더들이 등록된 이후에 호출됩니다. 즉, 프레임 워크에 의해 등록된 다른 모든 서비스들에 액세스 할 수 있다는 것을 의미합니다.


- 프로바이더 등록하기
```JavaScript
'providers' => [
    // Other Service Providers
    App\Providers\ComposerServiceProvider::class,
],
```

- 지연(deferred) 프로바이더
    - 프로바이더를 지연(defer) 로딩 하려면, \Illuminate\Contracts\Support\DeferrableProvider 인터페이스를 구현하고 provides 메소드를 정의하면 됩니다. provides 메소드는 프로바이더에 의해서 바인딩이 등록된 서비스 컨테이너를 리턴해야 합니다.

## Facade
- 라라벨 Facade 는 서비스 컨테이너에 등록되어 있는 서비스를 정적 메소드 형태로 사용해 줄 수 있게 한다.
- 라라벨 Facade 는 getFacadeAccessor() 를 구현하면 되며 config/app.php 에 라라벨 Facade 들을 확인해 볼수 있다.
- 라라벨 Facade 는 디자인 패턴 Facade Pattern 과는 개념이 다르다.


## 커스텀 헬퍼 클래스 추가
```JavaScript
composer.json 에 autoload 추가
composer dump-autoload 실행
```



## 함수 설명
- findOrFail
- refresh

- dispatch

- papertrail
- filter_var
