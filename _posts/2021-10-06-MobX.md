---
layout: post
title: "MobX"
description: 
headline: 
modified: 2021-10-06
category: webdevelopment
imagefeature: cover3.jpg
tags: [MobX]
mathjax: 
chart: 
share: true
comments: true
featured: true
disqus:
---

# Record
## 개념
- 

## 목차
- [observable](#observable)
- [toJS](#toJS)
- [set](#set)
- [computed](#computed)
- [autorun](#autorun)
- [action](#action)


### observable

- observable 데코레이터를 이용해 넘겨받은 객체 또는 값은 반응형 정보로 분류되어 observable 값이 바뀔 시 화면이 리렌더링 됩니다.
- @observable 를 선언함으로 Observable한 값으로 만들어줍니다.
- observable을 사용하면 하단의 함수에 의해 값이 바뀌면 해당 값을 사용하는 모든 view에서 리렌더링 됩니다.



### toJS

- mobx의 observable 값중에 객체나 배열의 경우 콘솔로 찍으면 {$mobx: ObservableObjectAdministration} 이런 값으로 보이면서 직관적으로 보기 힘든 경우가 있습니다. 저렇게 나오는 이유는 시스템 성능을 위해 그렇다고 mobx가 설명합니다.

```JavaScript
    class TestStore {
    @observable test = { a: 1, b: 2 };

    @action
    setToJS = () => {
        Object.keys(this.test).map(el => (this.test[el] = 3333));
        console.log(this.test); // {$mobx: ObservableObjectAdministration}
        console.log(toJS(this.test)); // {a: 333, b: 333}
    };
    }
```



## set

- store값을 store에서 바꾸지 않고, component에서 바꾸고 싶을때 사용합니다.
- 첫번째 파라미터로 바꿀 스토어, 두번째는 스토어 내부의 observer 대상, 세번째는 바꿀 값입니다.

```JavaScript
    const testStore = new TestStore();

    useEffect(() => {
        console.log(testStore);
        testStore.setToJS();
        // 바뀔 스토어 대상, 바뀔 observer 대상, 바뀌는 값
        set(testStore, "test", { a: 3, b: 55 });
    }, []);
```



## computed

- computed 는 observable 값을 기반으로 계산한 값을 리턴합니다. vue의 computed와 동일한 역할을 합니다. observable된 값이 바뀌면 computed 값도 연산되어 그 값을 바라보고 있는 view도 리렌더링 됩니다.
- computed는 동일한 값이 들어올 경우 값이 캐쉬되기 때문에 전역으로 만든 함수보다 더 효율성이 좋습니다.

```JavaScript
    class Rectangle {
        @observable width = 10;
        @observable height = 10;

        @computed // 값 캐쉬됨
        get area() {
            return this.width * this.height;
        }

        getArea() {
            // 값 캐쉬 안됨
            return this.width * this.height;
        }
    }

    const rect = new Rectangle();

    autorun(() => {
        document.getElementById("computed").innerText = rect.area.toString();
    });

    autorun(() => {
        document.getElementById("notComputed").innerText = rect.getArea().toString();
    });

    setInterval(() => {
        rect.width++;
    }, 1000);
```




## autorun

- autorun 은 내부 코드에 의해 자동으로 값이 업데이트됩니다. 이것을 mobx에서는 Reaction이라고 부릅니다. observable 값을 기반으로 연산이 이루어지는 면에서는 computed와 동일하지만, 용도가 다릅니다. 바뀌는 값을 기반으로 다른 값을 바꿔 view를 업데이트 하거나 console.log를 찍는 등, 사이드 이펙트를 내포하는 동작을 mobx에서는 Reaction이라고 부릅니다. autorun은 Reaction을 하는 방법중 하나입니다.
- React와 같이 쓰는 경우에는 다른 API로 Reaction을 할 수 있으므로 autorun을 사용할 일이 별로 없지만, React 없이 MobX만 사용하는 경우에는, autorun이 필수적입니다. 위에서 사용한 autorun예제로 사용할수 있습니다.
- autorun에 넘긴 익명 함수는 참조하고 있는 Observable 값이 변할때마다 반복해서 실행됩니다.


## action